<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Aran</title>
      <style>
      #main {
        width: 500px;
        margin: auto;
      }
      .code {
        font-family: "Lucida Console", Monaco, monospace;
      }
      .error {
        color: red;
      }
      button {
        margin-bottom: 30px;
      }
    </style>
    <script src="bundle.js"></script>
    <script>
      window.onload = function () {
        // Fetch elements
        var select = document.getElementById("select")
        var master = document.getElementById("master")
        var init = document.getElementById("init")
        var target = document.getElementById("target")
        var run = document.getElementById("run")
        var compiled = document.getElementById("compiled")
        var result_label = document.getElementById("result-label")
        var result = document.getElementById("result")
        var error_label = document.getElementById("error-label")
        var error = document.getElementById("error")
        // Master-select
        for (var name in window.masters) {
          var option = document.createElement("option")
          option.textContent = name
          option.value = name
          select.appendChild(option)
        }
        select.onchange = function () { master.value = window.masters[select.value] }
        select.value = "Empty"
        master.value = window.masters.Empty
        // Initialize
        init.onclick = function () {
          try { eval(master.value) }
          catch (e) { alert("Error in master: "+e); throw e }
          if (typeof sandbox === "undefined") { return alert("Sandbox is not defined.") }
          if (typeof hooks === "undefined") { return alert("Hooks are not defined.") }
          if (typeof traps === "undefined") { return alert("Traps are not defined.") }
          try { var analyze = window.Aran(sandbox, hooks, traps) }
          catch (e) { alert("Internal error: "+e); throw e }
          run.disabled = false
          run.onclick = function () {
            var o = analyze(target.value)
            compiled.textContent = o.compiled
            result_label.style.visibility = ("result" in o) ? "visible" : "hidden"
            error_label.style.visibility = ("error" in o) ? "visible" : "hidden"
            result.textContent = o.result
            error.textContent = o.error
            if (o.error) { console.dir(o.error) }
          }
        }
      }
    </script>
  </head>
  <body>
    <div id="main">
      <h1>Aran in action</h1>
      <!-- Master -->
      <label>Master:</label>
      <select id="select"></select>
      <br/>
      <textarea id="master" class="code" cols="70" rows="10" ></textarea><br/>
      <button id="init">Initialize</button><br/>
      <!-- Target -->
      <label>Target:</label>
      <br/>
      <textarea id="target" class="code" cols="70" rows="10"></textarea><br/>
      <button id="run" disabled>Run/Analyze</button><br/>
      <!-- Compiled -->
      <label>Compiled:</label>
      <br/>
      <p id="compiled" class="code"></p>
      <!-- Result -->
      <label id="result-label" style="visibility:hidden">Result:
        <span id="result" class="code"></span>
      </label>
      <br/>
      <!-- Error -->
      <label id="error-label" style="visibility:hidden">Error:
        <span id="error" class="code"></span>
      </label>
      <br/>
    </div>
  </body>
</html>
